# GU√çA R√ÅPIDA - M√≥dulo de Presupuesto

## ¬øQu√© se ha agregado?

Se ha a√±adido un m√≥dulo completo de gesti√≥n de presupuesto con importaci√≥n de CSV sin modificar nada del sistema existente de certificados.

## Archivos Creados

```
NUEVOS MODELOS Y CONTROLADORES:
‚îú‚îÄ‚îÄ app/models/PresupuestoItem.php ................ (Manejo BD presupuesto)
‚îú‚îÄ‚îÄ app/controllers/PresupuestoController.php ..... (L√≥gica de importaci√≥n)

NUEVAS VISTAS:
‚îú‚îÄ‚îÄ app/views/presupuesto/list.php ............... (Listar presupuestos)
‚îú‚îÄ‚îÄ app/views/presupuesto/upload.php ............. (Subir CSV)
‚îú‚îÄ‚îÄ app/views/presupuesto/view.php ............... (Ver detalles)

ARCHIVOS MODIFICADOS (M√çNIMAMENTE):
‚îú‚îÄ‚îÄ index.php .................................. (Agregadas 4 rutas)
‚îú‚îÄ‚îÄ app/views/layout/header.php .................. (Agregado men√∫)
‚îú‚îÄ‚îÄ database/install.php ......................... (Agregada tabla)

DOCUMENTACI√ìN:
‚îú‚îÄ‚îÄ PRESUPUESTO_README.md ........................ (Documentaci√≥n completa)
‚îú‚îÄ‚îÄ database/csv/plantilla_ejemplo.csv ........... (CSV de ejemplo)
```

## Paso 1: Usar el Sistema

### Opci√≥n A: Desde XAMPP en local

1. Aseg√∫rate que XAMPP est√© corriendo (Apache + MySQL)
2. Navega a: `http://localhost/programas/php-certificates/`
3. Ver√°s el Dashboard
4. En el men√∫, anda a: **Presupuesto > Importar CSV**

### Opci√≥n B: Crear tu CSV

Formato m√≠nimo:
```csv
PROGRAMA,FUENTE,COL1,COL5,CODIGOG1
"Mi Programa","Fuente 1",1000000,500000,01
```

**Columnas Importantes:**
- `PROGRAMA` - Nombre del programa
- `FUENTE` - Fuente de financiamiento
- `COL1` - Presupuesto asignado
- `COL3` - Presupuesto codificado
- `COL5` - Presupuesto comprometido
- `CODIGOG1-5` - C√≥digos de clasificaci√≥n

## Paso 2: Importar CSV

1. Ve a **Presupuesto > Importar CSV**
2. Haz clic en "Seleccionar archivo CSV"
3. Elige tu archivo (m√°x 10 MB)
4. Haz clic en "Importar"
5. ¬°Listo! Ver√°s confirmaci√≥n de registros importados

## Paso 3: Ver y Gestionar

1. Ve a **Presupuesto > Ver Presupuestos**
2. Ver√°s:
   - **Tarjetas de resumen**: Total asignado, comprometido, % ejecuci√≥n
   - **Tabla completa**: Todos los items importados
   - **Buscador**: Busca por programa, fuente o c√≥digo en tiempo real
3. Haz clic en **ojo** para ver detalles de un item
4. Haz clic en **basura** para eliminar un item

## Datos Incluidos en el CSV

El sistema importa autom√°ticamente:

| Dato | Columnas CSV |
|------|--------------|
| **Descripciones** | PROGRAMA, ACTIVIDAD, FUENTE, GEOGRAFICO, ITEM |
| **Montos** | COL1-COL10, COL20 |
| **C√≥digos** | CODIGOG1-CODIGOG5 |
| **C√°lculos** | Saldo disponible = COL3 - COL5 |

## Caracter√≠sticas Especiales

### üîç B√∫squeda en Tiempo Real
Sin recargar p√°gina, busca por:
- Nombre de programa
- Nombre de fuente
- C√≥digo de clasificaci√≥n

### üìä Estad√≠sticas Autom√°ticas
Se calculan autom√°ticamente:
- Total presupuesto asignado
- Total presupuesto comprometido
- Saldo disponible
- Porcentaje de ejecuci√≥n promedio

### üíæ Manejo de Moneda
Soporta autom√°ticamente:
- Formato: `1.234.567,89` (europeo)
- Formato: `1,234,567.89` (americano)
- S√≠mbolos: `$1000000`, `‚Ç¨1000000`
- Todo se convierte a: `1000000.89`

### üåç Encoding Autom√°tico
Detecta autom√°ticamente:
- UTF-8 (recomendado)
- CP1252 (Windows)
- ISO-8859-1 (Latin-1)

## Ejemplos Pr√°cticos

### Ejemplo 1: CSV Simple

```csv
PROGRAMA,FUENTE,COL1,COL3,COL5,CODIGOG1,CODIGOG3
"Educaci√≥n","Presupuesto General",5000000,4800000,3000000,01,10
"Salud","Presupuesto General",3000000,2800000,1800000,02,10
```

**Resultado:**
- Educaci√≥n: Saldo = 4,800,000 - 3,000,000 = 1,800,000
- Salud: Saldo = 2,800,000 - 1,800,000 = 1,000,000

### Ejemplo 2: CSV Completo (Tu archivo)

Ya incluye en `database/csv/plantilla_ejemplo.csv`:
- 6 programas reales
- 3 organizaciones
- 21 campos de informaci√≥n
- Datos de presupuesto reales

## URLs √ötiles

| Acci√≥n | URL |
|--------|-----|
| Dashboard | `index.php?action=dashboard` |
| Listar presupuestos | `index.php?action=presupuesto-list` |
| Importar CSV | `index.php?action=presupuesto-upload` |
| Ver item #5 | `index.php?action=presupuesto-view&id=5` |

## Tabla de Base de Datos

Se crea autom√°ticamente en `certificados_sistema`:

```sql
presupuesto_items
‚îú‚îÄ‚îÄ id (INT, Auto-increment)
‚îú‚îÄ‚îÄ descripciong1-5 (VARCHAR) .......... descripciones
‚îú‚îÄ‚îÄ col1-10, col20 (DECIMAL) .......... montos
‚îú‚îÄ‚îÄ codigog1-5 (VARCHAR) .............. c√≥digos
‚îú‚îÄ‚îÄ saldo_disponible (DECIMAL) ........ calculado
‚îú‚îÄ‚îÄ fecha_creacion (TIMESTAMP) ........ autom√°tico
‚îî‚îÄ‚îÄ fecha_actualizacion (TIMESTAMP) ... autom√°tico
```

## Validaciones Autom√°ticas

El sistema valida:

‚úÖ Archivo debe ser CSV  
‚úÖ Tama√±o m√°ximo: 10 MB  
‚úÖ Columnas reconocidas autom√°ticamente  
‚úÖ N√∫meros parseados correctamente  
‚úÖ UTF-8 garantizado  
‚úÖ L√≠neas vac√≠as ignoradas  
‚úÖ SQL injection prevenido (prepared statements)  

## Troubleshooting

### "Error: Solo se permiten archivos CSV"
‚Üí Aseg√∫rate que el archivo termina en `.csv`

### "Error: El archivo no debe superar 10MB"
‚Üí Tu CSV es muy grande, divide en partes

### "¬øCaracteres extra√±os en datos?"
‚Üí Abre el CSV con encoding UTF-8 en tu editor

### "¬øAlgunos datos no importados?"
‚Üí Revisa el resumen de importaci√≥n, muestra qu√© l√≠neas fallaron

## Ventajas del Sistema

1. **No modifica certificados**: Todo el sistema de certificados intacto
2. **Plug and Play**: Solo agrega, no cambia c√≥digo existente
3. **Robust**: Maneja autom√°ticamente encoding, formatos, errores
4. **R√°pido**: Importa 1000+ registros en segundos
5. **Seguro**: Prepared statements, validaci√≥n, escapado
6. **Profesional**: Bootstrap 5, dise√±o responsive
7. **Eficiente**: √çndices en BD, b√∫squeda en cliente
8. **Amigable**: Mensajes claros, gu√≠as, plantillas

## Pr√≥ximos Pasos

Puedes agregar:
- Exportar presupuesto a CSV/PDF
- Gr√°ficos de ejecuci√≥n
- Comparaci√≥n entre per√≠odos
- Alertas de saldos bajos
- M√°s campos de an√°lisis

## Contacto/Soporte

Para preguntas sobre el m√≥dulo, revisa:
- `PRESUPUESTO_README.md` - Documentaci√≥n completa
- C√≥digo comentado en cada archivo
- Ejemplos en `database/csv/`

---

**¬°Listo para usar! üöÄ**
